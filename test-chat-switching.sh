#!/bin/bash

# Test Script for Chat Profile Switching
# Monitors terminal output and provides test instructions

echo "üöÄ Chat Profile Switching Test Script"
echo "======================================"
echo ""
echo "This script will help you test chat functionality when switching profiles."
echo ""
echo "PREREQUISITES:"
echo "1. App should be running (npm start --clean)"
echo "2. You should be logged in"
echo "3. You should have access to at least 2 company profiles"
echo ""
echo "TEST SCENARIOS:"
echo ""
echo "SCENARIO 1: Basic Profile Switch"
echo "  1. Start on user profile"
echo "  2. Switch to Company A profile"
echo "  3. Check terminal for: 'StreamChat: User connected successfully'"
echo "  4. Navigate to Messages tab"
echo "  5. Verify no 'Error loading channel list' appears"
echo ""
echo "SCENARIO 2: Open Chat from Company Profile"
echo "  1. From Company A profile, go to a user's profile"
echo "  2. Tap 'Start Chat' or message button"
echo "  3. Verify chat opens without errors"
echo "  4. Check terminal for: 'Client is ready (from provider)'"
echo ""
echo "SCENARIO 3: Switch Between Companies"
echo "  1. Switch: User ‚Üí Company A ‚Üí Company B"
echo "  2. After each switch, verify connection in terminal"
echo "  3. After Company B switch, open chat with a user"
echo "  4. Verify chat loads and works correctly"
echo ""
echo "SCENARIO 4: Send Message After Switch"
echo "  1. Switch to a company profile"
echo "  2. Open chat with a user"
echo "  3. Wait for chat to fully load (check terminal)"
echo "  4. Send a test message: 'Test message from company profile'"
echo "  5. Verify message appears in chat"
echo "  6. Check terminal for any errors"
echo ""
echo "SCENARIO 5: Multiple Rapid Switches"
echo "  1. Rapidly switch: User ‚Üí Company A ‚Üí Company B ‚Üí User ‚Üí Company A"
echo "  2. After final switch, open chat"
echo "  3. Verify chat works correctly"
echo "  4. Check terminal for connection errors"
echo ""
echo "MONITORING:"
echo "Watch the terminal output for these patterns:"
echo ""
echo "‚úÖ GOOD SIGNS:"
echo "  - 'StreamChat: User connected successfully'"
echo "  - 'Client is ready (from provider)'"
echo "  - 'Channel watched successfully'"
echo "  - 'Conversation created successfully'"
echo ""
echo "‚ùå BAD SIGNS (should NOT appear):"
echo "  - 'Both secret and user tokens are not set'"
echo "  - 'Error loading channel list'"
echo "  - 'Property useStreamChatReady doesn't exist'"
echo "  - 'Client connection timeout'"
echo "  - 'Failed to watch channel'"
echo ""
echo "======================================"
echo ""
echo "Press Enter to start monitoring terminal output..."
read

# Monitor terminal log if it exists
TERMINAL_LOG="$HOME/.cursor/projects/Users-aghone01-Documents-CS-OneCrewApp/terminals/6.txt"

if [ -f "$TERMINAL_LOG" ]; then
    echo "üìä Monitoring terminal log: $TERMINAL_LOG"
    echo "Press Ctrl+C to stop"
    echo ""
    tail -f "$TERMINAL_LOG" | grep --line-buffered -E "(ERROR|WARN|StreamChat|Client|Channel|tokens|ready|connected)" || true
else
    echo "‚ö†Ô∏è  Terminal log not found. Make sure the app is running."
    echo "Expected path: $TERMINAL_LOG"
fi
